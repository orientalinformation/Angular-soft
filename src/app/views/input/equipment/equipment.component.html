<div class="container" *ngIf="study">
  <app-chaining #chainingControls (loaded)="onChainingControlsLoaded()" *ngIf="study.CHAINING_CONTROLS"></app-chaining>
  
  <div class="row product-container">
    <div class="col-md-6" *ngIf="study.OPTION_ECO">
      <div class="card">
        <div class="card-header">
          <strong style="margin-top:5px;margin-left:5px;">{{'PRICE OF THE CRYOGEN' | translate}}</strong>
          <!-- <button type="button" class="btn btn-sm btn-success float-right" (click)="savePrice()" [ladda]="isUpdatePrice" [disabled]="!studyModifiable()">
            <i class="fa fa-pencil-square-o"></i> {{'Update'|translate}}
          </button>
          <button type="button" class="btn btn-sm btn-primary float-right" (click)="refreshPrice()" [disabled]="!studyModifiable()" style="margin-right: 10px;">
            <i class="fa fa-refresh"></i>
          </button> -->
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-8" style="margin-top:5px;">
              <p>{{'Define the price of the Cryogen :'|translate}}</p>
            </div>
            <div class="col-4">
              <div class="input-group" style="width:120px;" *ngIf="unitData">
                <input type="text" name="text-input" class="form-control" [(ngModel)]="unitData.Price" (change)="savePrice()" placeholder="0.00" [disabled]="!studyModifiable()">
                <span class="input-group-addon">
                  <small *ngIf="symbol" [innerHTML]="symbol.monetarySymbol"></small>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <strong style="margin-top:5px;margin-left:5px;">{{'LOADING RATE' | translate}}
            <span class="text-muted">{{'Spaces (length and width)'| translate}}</span>
          </strong>
          <!-- <button type="button" class="btn btn-sm btn-success float-right" (click)="saveInterval()" [ladda]="isUpdateInterval" [disabled]="!studyModifiable()">
            <i class="fa fa-pencil-square-o"></i> {{'Update'|translate}}
          </button>
          <button type="button" class="btn btn-sm btn-primary float-right" (click)="refreshIntervalLW()" style="margin-right: 10px;" [disabled]="!studyModifiable()">
            <i class="fa fa-refresh"></i>
          </button> -->
        </div>
        <div class="card-body">
          <div class="row">            
            <div class="col-md-12">
              <div class="container">
                <div class="row">
                  <div class="col-md-5 auto">
                    <div class="input-group" *ngIf="unitData">
                      <input type="text" name="text-input" class="form-control" [(ngModel)]="unitData.IntervalLength" (change)="saveInterval()" placeholder="0.00" [disabled]="!studyModifiable()">
                      <span class="input-group-addon" *ngIf="symbol">
                        {{ symbol.prodDimensionSymbol }}
                      </span>
                    </div>
                  </div>
                  <div class="col-md-2 text-center">x</div>
                  <div class="col-md-5">
                    <div class="input-group" *ngIf="unitData">
                      <input type="text" name="text-input" class="form-control" [(ngModel)]="unitData.IntervalWidth" (change)="saveInterval()" placeholder="0.00" [disabled]="!studyModifiable()">
                      <span class="input-group-addon" *ngIf="symbol">
                        {{ symbol.prodDimensionSymbol }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="card product-container">
   
    <div class="card-header">
      <strong>{{'SELECTED EQUIPMENT' | translate}}</strong>
     
      <div class="float-right">
        <button class="btn btn-sm btn-primary" (click)="recalculateEquipment()" [disabled]="!studyModifiable()">
            {{'Recalculate equipment parameters'|translate}}
        </button>
        <button class="btn btn-sm btn-success" data-toggle="modal" (click)="onShowAddEquip()" [ladda]="laddaListingEquipments" [disabled]="!studyModifiable()" [disabled]="!studyModifiable()">
          <i class="fa fa-plus"></i>
          {{'Add'|translate}}
        </button>
        
      </div>
    </div>
    <table class="table table-bordered table-sm mb-0" *ngIf="equipmentsView && isUpdateInterval == false">
      <tr *ngIf="symbol">
        <th class="text-center align-middle"><small>{{'Calculate'|translate}}</small></th>
        <th class="text-center align-middle"><small>{{'Name'|translate}}</small></th>
        <th class="text-center align-middle"><small>{{'Product orientation'|translate}}</small></th>
        <th class="text-center align-middle"><small>{{'Residence / Dwell time'|translate}} ({{symbol.timeSymbol}})</small></th>
        <th class="text-center align-middle"><small>{{'Control temperature'|translate}} ({{symbol.temperatureSymbol}})</small></th>
        <th class="text-center align-middle"><small>{{'Convection Setting'|translate}} ({{symbol.convectionSpeedSymbol}})</small></th>
        <th class="text-center align-middle"><small>{{'Conveyor coverage or quantity of product per batch'|translate}}</small></th>
        <th class="text-center align-middle"><small>{{'Actions'|translate}}</small></th>
      </tr>
      <tr *ngFor="let equip of equipmentsView; let i = index">
        <td>
          <label style="margin-left:1.5em;margin-top:0.7em" class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input">
            <span class="custom-control-indicator"></span>
          </label>
        </td>
        <td class="text-center align-middle">{{ equip.displayName }}</td>
        <td class="text-center align-middle">
          <span *ngIf="equip.ORIENTATION == 0">{{'Perpendicular'|translate}}</span>
          <span *ngIf="equip.ORIENTATION == 1">{{'Parallel'|translate}}</span>
        </td>
        <td class="text-center align-middle">
          <span class="d-block" *ngFor="let ts of equip.ts">{{ equip.ts }}</span>
        </td>
        <td class="text-center align-middle">
          <span class="d-block" *ngFor="let tr of equip.tr">{{ equip.tr }}</span>
        </td>
        <td class="text-center align-middle">
          <span class="d-block" *ngFor="let vc of equip.vc">{{ equip.vc }}</span>
        </td>
        <td class="text-center align-middle">
          {{ equip.top_or_QperBatch }}
        </td>
        <td class="text-center align-middle" width="1%">
          <div style="margin-top:0.5em; white-space: nowrap">
            <button type="button" [disabled]="!studyModifiable()" class="btn btn-success btn-sm" (click)="equipEditConfig(equip, i)" ngbTooltip="Operational settings"><i class="fa fa-cogs"></i></button>
            <button type="button" [disabled]="!studyModifiable()" class="btn btn-primary btn-sm" [ladda]="laddaLoadingLayout" (click)="equipEditLayout(equip, i)" ngbTooltip="Layout editor"><i class="fa fa-th-large"></i></button>
            <button type="button" [disabled]="!studyModifiable()" class="btn btn-danger btn-sm" (click)="deleteStudyEquipment(equip ,i)" ngbTooltip="Remove" [ladda]="laddaDeletingStudyEquip[i]"><i class="fa fa-trash"></i></button>
          </div>  
        </td>
      </tr>
    </table>
      
  </div> <!-- /.card -->
</div>

<div bsModal class="modal fade bd-example-modal-lg" #addEquipModal="bs-modal" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-primary" role="document" style="max-width:80%;" >
    <div class="modal-content">
      <div class="modal-header">
        <strong>{{'EQUIPMENT' | translate}}</strong>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="addEquipModal.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" *ngIf="equipments">
        <div class="card-group">
          <!-- Filter card -->
          <div class="card" >
            <div class="card-header" style="text-align:center;">
              <strong >{{'Selection criteria'|translate}}</strong>
            </div>
            <div class="card-body">
              <div class="row form-group">
                <div class="col-4">{{'Type of Refrigeration'|translate}}</div>
                <div class="col-8">
                  <select class="form-control" [(ngModel)]="energySelected" (change)="select_energy()">
                    <option [value]="-1">{{ 'All'|translate }}</option>
                    <option *ngFor="let energy of energies" [value]="energy.ID_COOLING_FAMILY">
                      {{ energy.LABEL }}
                    </option>
                  </select>
                </div>
              </div>
              
              <div class="row form-group">
                <div class="col-4">{{'Manufacturer'|translate}}</div>
                <div class="col-8">
                  <select class="form-control" [(ngModel)]="manufacturerSelected" (change)="select_manufacturer()">
                    <option value="">{{ 'All'|translate }}</option>
                    <option *ngFor="let item of manufacturer; let i = index" [value]="item.CONSTRUCTOR">
                      {{ item.CONSTRUCTOR }}
                    </option>
                  </select>
                </div>
              </div>

              <div class="row form-group">
                <div class="col-4">{{'Equipment Series'|translate}}</div>
                <div class="col-8">
                  <select class="form-control" [(ngModel)]="familySelected" (change)="select_family()">
                    <option [value]="-1">{{ 'All'|translate }}</option>
                    <option *ngFor="let family of families; let i = index" [value]="family.ID_FAMILY">
                      {{ family.LABEL }}
                    </option>
                  </select>
                </div>
              </div>
            
              <div class="row form-group">
                <div class="col-4">{{'Equipment origin'|translate}}</div>
                <div class="col-8">
                  <select class="form-control" [(ngModel)]="originSelected" (change)="select_origin()">
                    <option [value]="-1">{{ 'All'|translate }}</option>
                    <option *ngFor="let origin of origins; let i = index" [value]="origin.STD">
                      {{ origin.LABEL }}
                    </option>
                  </select>
                </div>
              </div>
            
              <div class="row form-group">
                <div class="col-4">{{'Process type'|translate}}</div>
                <div class="col-8">
                  <select class="form-control" [(ngModel)]="processSelected" (change)="select_process_type()">
                    <option [value]="-1">{{ 'All'|translate }}</option>
                    <option *ngFor="let process of processes; let i = index" [value]="process.BATCH_PROCESS">
                      {{ process.LABEL }}
                    </option>
                  </select>
                </div>
              </div>
            
              <div class="row form-group">
                <div class="col-4">{{'Model'|translate}}</div>
                <div class="col-8">
                  <select class="form-control" [(ngModel)]="seriesSelected" (change)="select_model()">
                    <option [value]="-1">{{ 'All'|translate }}</option>
                    <option *ngFor="let seri of series; let i = index" [value]="seri.ID_EQUIPSERIES">
                      {{ seri.LABEL }}
                    </option>
                  </select>
                </div>
              </div>
            
              <div class="row form-group">
                <div class="col-4" *ngIf="symbol">{{'Size'|translate}} ({{symbol.equipDimensionSymbol}})</div>
                <div class="col-8">
                  <select class="form-control" [(ngModel)]="dimensionSelected" (change)="select_size()">
                    <option value="">{{ 'All'|translate }}</option>
                    <option *ngFor="let dimension of dimensions; let i = index" value="{{ dimension.EQP_LENGTH }}x{{ dimension.EQP_WIDTH }}">
                      {{ dimension.DISPLAY_LENGTH }} x {{ dimension.DISPLAY_WIDTH }}
                    </option>
                  </select>
                </div>
              </div>
            </div>
          </div>
    
          <div class="card" >
            <div class="card-header" style="text-align:center;">
              <div id="equipment-search-box-container">&nbsp;
                <div class="input-group input-group-sm" id="equipment-search-box">
                  <input type="text" class="form-control" [(ngModel)]="filterString" placeholder="{{'Search'|translate}}" />
                  <span>
                    <i class="fa fa-search" aria-hidden="true"></i>
                  </span>
                </div>
              </div>
            </div>
            <perfect-scrollbar style="max-height:380px;">
              <div class="list-group" name="add" >
                <a class="list-group-item list-group-item-action" *ngFor="let equip of (equipments | filter: filterString)"
                  style="height:30px; padding: 5px 10px;"  name="eid" id="eid" (click)="onSelectAddingEquipment(equip)"
                  [ngClass]="equip == selectedAddingEquipment? 'active' : ''">
                    {{equip.EQUIP_NAME}} - {{equip.EQUIP_VERSION}} 
                  <span *ngIf="equip.EQUIP_RELEASE == 3">({{'Active'|translate}})</span>
                </a>
              </div>
            </perfect-scrollbar>
          </div>
            
          </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-dismiss="modal" (click)="addEquipModal.hide()">{{'Cancel'|translate}}</button>
        <button class="btn btn-primary" (click)="onAddEquip()" [ladda]="laddaAddingEquipment">{{'Confirm'|translate}}</button>
      </div>
    </div>
  </div>
</div>

<div bsModal class="modal fade bd-example-modal-lg" #editModal="bs-modal" role="dialog" aria-hidden="true"  >
    <div class="modal-dialog modal-primary" role="document" style="max-width:60%;" *ngIf="editLayoutForm">
      <div class="modal-content">
        <div class="modal-header"><strong >{{'TOC Wizard'|translate}}</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeEditModal()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
        <h5 class="text-danger" *ngIf="equipment">{{ equipment.displayName }}</h5>
        <div style="padding: 5px 0"><strong >Input :</strong></div>  
        <div class="row">
          <div class="col-md-7">
            <div class="form-group row">
              <div class="col-md-6" *ngIf="symbol">{{'Spaces (length x width)'|translate}} ({{symbol.equipDimensionSymbol}})</div>
              <input type="text" class="col-md-2" style="height:30px;" [(ngModel)]="editLayoutForm.lengthInterval">
              <div class="col-md-2"></div>
              <input type="text"class="col-md-2" style="height:30px;" [(ngModel)]="editLayoutForm.widthInterval">
            </div>
            <div class="form-group row">
              <div class="col-md-6">{{'Orientation'|translate}}</div>
              <select class="form-control col-md-6" [(ngModel)]="editLayoutForm.orientation">
                  <option value="1">{{'Parallel'|translate}}</option>
                  <option value="0">{{'Perpendicular'|translate}}</option>
              </select>
            </div>
            <div class="form-group row" *ngIf="1==0">
              <div class="col-md-6">{{'Shelves'|translate}}</div>
              <select class="form-control col-md-6"></select>
            </div>
            <div class="form-group row" *ngIf="1==0">
              <div class="col-md-6" *ngIf="symbol">{{'Dimensions'|translate}} ({{'length'|translate}} x {{'width'|translate}}) ({{symbol.prodDimensionSymbol}})</div>
              <input type="text" class="col-md-2" style="height:30px;" >
              <div class="col-md-2"></div>
              <input type="text"class="col-md-2" style="height:30px;">
            </div>
            <div class="form-group row" *ngIf="1==0">
              <div class="col-md-6">{{'Number of shelves'|translate}}</div>
              <input type="text" class="col-md-3" style="height:30px;" >
            </div>
          </div>
          <div class="col-md-5">
            <div style="float:right">
              <div style="width: 250px; height: 250px; border:1px solid #ccc" id="top_show_svg">
                <h3 class="text-muted text-center">Image not available</h3>
              </div>
            </div>
          </div>
        </div>
        <div style="padding:10px;"><strong >{{'Output'|translate}} :</strong></div> 
        <table class="table  table-bordered table-sm"  >
          <thead>
            <tr *ngIf="symbol">
              <td align="center" *ngIf="equipment.ORIENTATION == 0;else equipTitle;"><strong>Width of Spaces. ({{symbol.shelvesWidthSymbol}})</strong></td>
              <ng-template #equipTitle>
              <td align="center"><strong>Side remaining interval ({{symbol.shelvesWidthSymbol}})</strong></td>
              </ng-template>
              <td align="center" *ngIf="equipment.ORIENTATION == 1;else equipNumberPer;"><strong> {{'Number per tunnel length'|translate}}</strong></td>
              <ng-template #equipNumberPer>
              <td align="center"><strong>{{'Number of items per meter run'|translate}}. ({{symbol.shelvesWidthSymbol}})</strong></td>
              </ng-template>
              <td align="center"><strong> {{'Number of items in belt width'|translate}}.</strong></td>
              <td align="center"><strong> {{'Conveyor coverage or quantity of product per batch'|translate}}</strong></td>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="symbol && equipment.layoutResults != ''">
              <td align="center">{{equipment.layoutResults.LEFT_RIGHT_INTERVAL}}</td>
              <td align="center">{{equipment.layoutResults.NUMBER_PER_M}}</td>
              <td align="center">{{equipment.layoutResults.NUMBER_IN_WIDTH}}</td>
              <td align="center" *ngIf="equipment">{{equipment.top_or_QperBatch}}</td>
            </tr>
          </tbody>
        </table>
        <div>
          <strong style="padding:15px;" *ngIf="equipment.layoutResults != ''">{{'Belt coverage'|translate}} <input type="text" value="{{equipment.layoutResults.LOADING_RATE}}" style="heigth:30px;width:60px;" disabled="true"> (%)</strong>
          <div style="float:right;margin-right:20px;" >
            <button class="btn btn-md btn-secondary" (click)="closeEditModal()">{{'Close'|translate}}</button>
            <button class="btn btn-md btn-primary" (click)="updateStdEquipLayout()">{{'Apply'|translate}}</button>
          </div>
        </div>
      </div> 
    </div>
  </div>
</div>
